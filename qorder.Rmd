---
title: "subsetr"
author: "Michael Pearson"
date: "3/17/2018"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr, quietly = TRUE)
library(readr, quietly = TRUE)
library(R.utils, quietly = TRUE)
library(SnowballC, quietly = TRUE)
library(tidyr, quietly = TRUE)
library(data.table, quietly = TRUE)
library(quanteda)
library(data.table, quietly = TRUE)
library(readtext)
library(stringr)
```

## Remove the one-offs


## now let's process the ones with multiple bigrams

``` {r trigrams, eval = TRUE}
blocky <- function(trap, tim, ful_tri) {
a <- floor(nrow(tim)/1000)
b <- 1000
c <- a
d <- 1
 full_tri <- data.table()
 downstream <- 0.5
 for (j in 1:b)
  {
    mid_tri <- data.table()
    if(nrow(tim) > a )
      {
setkey(trixy,bigrams)
      for (i in d:a)
{ 
##setkey(trixy,bigrams)
tardis <- trixy[as.character(aggy$bigrams[i])]
tardis$prob <- (tardis$tri_gram_ns_ns - downstream)/aggy$sum[i]
mid_tri <- rbind(mid_tri, tardis)
##trixy <- trixy[bigrams != aggy$bigrams[i],]
##print(paste("i is ",i))
##print(paste("number of rows in trixy is ",nrow(trixy)))
}
    d <- a + 1
    a <- a + c    
      }
    else {
      a <- nrow(trixy)
      d <- a - 4
    for (i in d:a)
{ 
tardis <- trixy[bigrams == aggy$bigrams[i],]
tardis$prob <- (tardis$tri_gram_ns_ns - downstream)/aggy$sum[i]
mid_tri <- rbind(mid_tri, tardis)
trixy <- trixy[bigrams != aggy$bigrams[i],]
##print(paste("i is ",i))
}  
    }
   full_tri <- rbind(full_tri, mid_tri)
##print(paste("j is ",j))
  ##  print(paste("a is ", a))
  ##  print(paste("d is ",d))
 }
return(full_tri)
}
combi_tri_ns_ns <- read.csv("/Users/mutecypher/Documents/Documents - Michael’s iMac/Coursera/Capstone Project/20sample/combi_tri_ns_ns.csv", colClasses = c("NULL", NA, NA, NA) )
combi_tri_ns_ns <- data.table(combi_tri_ns_ns)
trixy <- combi_tri_ns_ns[combi_tri_ns_ns$tri_gram_ns_ns >= 4,]
tramp <- table(trixy$bigrams)
tramp <- unlist(tramp, recursive = TRUE)
tramp <- as.data.table(tramp)
tramp <- tramp[tramp$N > 4,]
##tim <- unique(trixy$bigrams)
##tim <- as.character(tim)
##tim <- data.table(tim)
aggy <- trixy[,.(sum = sum(tri_gram_ns_ns)), by = bigrams]
aggy <- data.table(aggy)
blah <- blocky(trixy, aggy, full_tri)
write.csv(blah,file = "/Users/mutecypher/Documents/Documents - Michael’s iMac/Coursera/Capstone Project/20sample/nosingles_stri_ns_ns.csv" )
rm(trixy)
rm(aggy)
rm(combi_tri_ns_ns)
```

## should run first


``` {r quadgrams, eval = TRUE}
blocky <- function(trap, tim, ful_tri) {
a <- floor(nrow(tim)/1000)
b <- 1000
c <- a
d <- 1
 full_tri <- data.table()
 downstream <- 0.5
 for (j in 1:b)
  {
    mid_tri <- data.table()
    if(nrow(tim) > a )
      {
setkey(trixy,trigrams)
      for (i in d:a)
{ 
##setkey(trixy,bigrams)
tardis <- trixy[as.character(aggy$trigrams[i])]
tardis$prob <- (tardis$quad_gram_ns_ns - downstream)/aggy$sum[i]
mid_tri <- rbind(mid_tri, tardis)
##trixy <- trixy[bigrams != aggy$bigrams[i],]
##print(paste("i is ",i))
##print(paste("number of rows in trixy is ",nrow(trixy)))
}
    d <- a + 1
    a <- a + c    
      }
    else {
      a <- nrow(trixy)
      d <- a - 4
    for (i in d:a)
{ 
tardis <- trixy[as.character(aggy$trigrams[i])]
tardis$prob <- (tardis$tri_gram_ns_ns - downstream)/aggy$sum[i]
mid_tri <- rbind(mid_tri, tardis)
##trixy <- trixy[bigrams != aggy$bigrams[i],]
##print(paste("i is ",i))
}  
    }
   full_tri <- rbind(full_tri, mid_tri)
##print(paste("j is ",j))
  ##  print(paste("a is ", a))
  ##  print(paste("d is ",d))
 }
return(full_tri)
}
combi_quad_ns_ns <- read.csv("/Users/mutecypher/Documents/Documents - Michael’s iMac/Coursera/Capstone Project/20sample/combi_quad_ns_ns.csv", colClasses = c("NULL", NA, NA, NA) )
combi_quad_ns_ns <- data.table(combi_quad_ns_ns)
trixy <- combi_quad_ns_ns[combi_quad_ns_ns$quad_gram_ns_ns >= 6,]
tramp <- table(trixy$trigrams)
tramp <- unlist(tramp, recursive = TRUE)
tramp <- as.data.table(tramp)
tramp <- tramp[tramp$N > 4,]
##tim <- unique(trixy$bigrams)
##tim <- as.character(tim)
##tim <- data.table(tim)
aggy <- trixy[,.(sum = sum(quad_gram_ns_ns)), by = trigrams]
aggy <- data.table(aggy)
blah <- blocky(trixy, aggy, full_tri)
write.csv(blah,file = "/Users/mutecypher/Documents/Documents - Michael’s iMac/Coursera/Capstone Project/20sample/nosingles_stri_ns_ns.csv" )
rm(trixy)
rm(aggy)
rm(combi_quad_ns_ns)
```
Now the Quin-grams

```{r quingrams}
blocky <- function(trap, tim, ful_tri) {
a <- floor(nrow(tim)/1000)
b <- 1000
c <- a
d <- 1
 full_tri <- data.table()
 downstream <- 0.5
 for (j in 1:b)
  {
    mid_tri <- data.table()
    if(nrow(tim) > a )
      {
setkey(trixy,quadgrams)
      for (i in d:a)
{ 
##setkey(trixy,bigrams)
tardis <- trixy[as.character(aggy$trigrams[i])]
tardis$prob <- (tardis$quin_gram_ns_ns - downstream)/aggy$sum[i]
mid_tri <- rbind(mid_tri, tardis)
##trixy <- trixy[bigrams != aggy$bigrams[i],]
##print(paste("i is ",i))
##print(paste("number of rows in trixy is ",nrow(trixy)))
}
    d <- a + 1
    a <- a + c    
      }
    else {
      a <- nrow(trixy)
      d <- a - 4
    for (i in d:a)
{ 
tardis <- trixy[as.character(aggy$trigrams[i])]
tardis$prob <- (tardis$quad_gram_ns_ns - downstream)/aggy$sum[i]
mid_tri <- rbind(mid_tri, tardis)
##trixy <- trixy[bigrams != aggy$bigrams[i],]
##print(paste("i is ",i))
}  
    }
   full_tri <- rbind(full_tri, mid_tri)
##print(paste("j is ",j))
  ##  print(paste("a is ", a))
  ##  print(paste("d is ",d))
 }
return(full_tri)
}
combi_quin_ns_ns <- read.csv("/Users/mutecypher/Documents/Documents - Michael’s iMac/Coursera/Capstone Project/20sample/combi_quin_ns_ns.csv", colClasses = c("NULL", NA, NA, NA) )
combi_quin_ns_ns <- data.table(combi_quin_ns_ns)
trixy <- combi_quad_ns_ns[combi_quad_ns_ns$quad_gram_ns_ns >= 6,]
tramp <- table(trixy$quadgrams)
tramp <- unlist(tramp, recursive = TRUE)
tramp <- as.data.table(tramp)
tramp <- tramp[tramp$N > 4,]
##tim <- unique(trixy$bigrams)
##tim <- as.character(tim)
##tim <- data.table(tim)
aggy <- trixy[,.(sum = sum(quad_gram_ns_ns)), by = trigrams]
aggy <- data.table(aggy)
blah <- blocky(trixy, aggy, full_tri)
write.csv(blah,file = "/Users/mutecypher/Documents/Documents - Michael’s iMac/Coursera/Capstone Project/20sample/nosingles_stri_ns_ns.csv" )
rm(trixy)
rm(aggy)
rm(combi_quin_ns_ns)
```

